name: Documentation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build-docs:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install sphinx sphinx-rtd-theme sphinx-autodoc-typehints
        pip install -r requirements.txt
    
    - name: Verify documentation structure
      run: |
        test -d docs || (echo "docs/ directory not found" && exit 1)
        test -f docs/README.md || (echo "docs/README.md not found" && exit 1)
        test -f docs/GETTING_STARTED.md || (echo "docs/GETTING_STARTED.md not found" && exit 1)
        test -f docs/INSTALLATION.md || (echo "docs/INSTALLATION.md not found" && exit 1)
        test -f docs/ARCHITECTURE.md || (echo "docs/ARCHITECTURE.md not found" && exit 1)
        echo "Documentation structure verified"
    
    - name: Check for broken links
      run: |
        pip install linkchecker
        # Check markdown files for broken internal links
        find docs/ -name "*.md" -type f | while read file; do
          echo "Checking $file"
          grep -o '\[.*\](.*\.md)' "$file" || true
        done
    
    - name: Build API documentation
      run: |
        # Generate API documentation if sphinx is configured
        if [ -f docs/conf.py ]; then
          sphinx-build -b html docs/ docs/_build/html -W
        else
          echo "Sphinx not configured, skipping API doc build"
        fi
      continue-on-error: true
